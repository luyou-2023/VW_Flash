
# FOME ECU 中文文档（技术实现版）

## 1. Sensors and Gauges（传感器与仪表实现）

### 1.1 油门踏板 (Accelerator Pedal)
目标：检测油门开度，作为发动机负载输入。  
实现方法：两路信号冗余，ADC 转换，低通滤波平滑，输出负载百分比，异常偏差触发安全模式。

### 1.2 曲轴传感器 (Crank Sensor)
目标：提供曲轴角度与转速。  
实现方法：中断处理每齿信号，计算瞬时 RPM，用于点火、喷油触发及空气量计算，异常触发熄火保护。

### 1.3 凸轮轴传感器 (Cam Sensor)
目标：确定气缸相序，实现顺序喷油和精准点火。  
实现方法：边沿检测，状态机生成喷油触发时间，支持单/双凸轮，高速过零检测。异常报警或降功率保护。

### 1.4 MAP 传感器 (Manifold Absolute Pressure)
目标：测量进气歧管压力，用于 Speed Density 算法计算空气量。  
实现方法：ADC 电压读取，转换 kPa，计算空气流量 VE*MAP/RT*k，输出喷油量参考。

### 1.5 进气温度 (IAT) & 冷却液温度 (CLT)
目标：燃油与点火修正，热补偿。  
实现方法：热敏电阻 ADC 转换，查表或公式得 °C。燃油修正：Fuel = BaseFuel * CoolantMultiplier(CLTemp) * IATMultiplier(IAT)。

### 1.6 Wideband O2（宽带氧传感器）
目标：实时空燃比测量，闭环控制。  
实现方法：泵电流测 Lambda，AFR=Lambda*AFR_Stoichiometric，闭环控制 FuelAdjustment = Kp*Error + Ki*Integral(Error)。

### 1.7 车速传感器 (VSS)
目标：监控车速，用于动态燃油与点火调整。  
实现方法：脉冲信号计算车速，触发怠速控制、减速燃油切断和转速限制。

### 1.8 信号异常检测与保护逻辑
TPS、MAP、CLT、IAT 超范围或异常 -> ECU 安全模式；曲轴/凸轮信号异常 -> 限制转速或关闭喷油；Wideband AFR异常 -> 开环 AFR 表替代。

## 2. Fuel（燃油系统实现）

### 2.1 燃油控制算法
- **Alpha-N**：基于节气门开度与转速，查表 VE 对应喷油量。  
- **Speed Density**：基于 MAP 和 IAT 推算空气量，喷油量=空气量/喷油器流量。  
- **MAF**：直接测空气流量，计算喷油量。

### 2.2 空燃比与喷油量计算
- AFR 目标表查找 -> Lambda 计算  
- 基础喷油量：FuelBase = VE_table*AirDensity*CorrectionFactors  
- 修正：冷却液温度、进气温度、TPS、每缸微调、Flex Fuel 等修正乘以 FuelBase  
- 喷油脉宽 = FuelBase / (喷油器流量 * ECU电压校正) + Deadtime

### 2.3 燃油控制功能
- **冷却液修正**：低温增加燃油丰富度。  
- **每缸燃油修正**：修正各气缸差异，平衡空燃比。  
- **减速燃油切断**：车辆减速时关闭喷油。  
- **Flex Fuel**：根据燃料乙醇比例调整 AFR 目标。  
- **小脉宽修正**：极短喷油脉宽非线性补偿。  
- **闭环控制**：Wideband 反馈实时调整燃油量。

## 3. Ignition（点火系统实现）

### 3.1 点火硬件
- 智能线圈 vs 普通线圈：智能线圈自带驱动，普通线圈需外部驱动。  
- 点火驱动器：根据 Dwell 计算，控制线圈充能。

### 3.2 点火设置
- **Dwell**：线圈充能时间，保证火花强度。  
- **点火顺序 (Firing Order)**：保证燃烧顺序正确。  
- **IAT 点火附加**：进气温度修正点火提前角。  
- **点火模式 (Ignition Mode)**：固定/动态控制模式。  
- **点火提前表 (Ignition Advance Table)**：不同工况点火提前角查表。  
- **冷却液点火修正**：冷却液温度影响点火角。  
- **每缸点火修正**：微调各缸点火角，平衡动力。

### 3.3 点火类型
- 单独线圈 (Individual Coils)  
- 顺序点火 (Sequential Ignition)  
- 废火花 (Wasted Spark)  
- 单线圈/分电器 (Single Coil/Distributor)  

### 3.4 点火控制逻辑
- 曲轴角度 + 凸轮轴相序 -> 决定顺序喷油与点火时机。  
- 点火提前表结合负载、RPM、温度修正，输出点火触发信号。  
- 异常保护：过压、过热、传感器异常 -> 限制点火或熄火保护。

---

## 📌 注释
本文档为 FOME ECU 核心技术实现中文整理版，涵盖 **传感器信号处理、燃油计算、点火控制与安全逻辑**，便于调校与二次开发参考。
